
<div class="row">
	<div class="col-12">
		<div class="card">

			<div class="card-header">
				<div class="card-title">
					<h4 i18n="@@cartDeliveryTitle">Delivery method</h4>
				</div>
			</div>
			<div class="card-body">
				<ul class="nav nav-pills nav-fill">
					<li class="nav-item" (click)="onSetDelivery('branch')">
						<span class="nav-link" [ngClass]="{'active': deliveryMethod === 'branch'}" i18n="@@cartDeliveryOptionBranchButton">At branch</span>
					</li>
					<li class="nav-item" (click)="onSetDelivery('bring')">
						<span class="nav-link" [ngClass]="{'active': deliveryMethod === 'bring'}" i18n="@@cartDeliveryOptionBringButton">By mail</span>
					</li>
				</ul>
			</div>

			<div class="card-body" *ngIf="deliveryMethod === 'branch'">
				<div class="row">
                    <div class="col-12">
                        <h4 i18n="@@cartDeliveryOptionBranchTitle">Get items at branch</h4>
						<p>
							<span i18n="@@cartDeliveryOptionBranchDescription">Retrieve the items yourself at</span>
							<b>{{branch.name}}</b>
						</p>
                    </div>
                </div>
			</div>

			<div class="card-body" *ngIf="deliveryMethod === 'bring'">
				<div class="row">
                    <div class="col-12">
                        <h4 i18n="@@cartDeliveryOptionBringTitle">Delivery by mail</h4>
                        <p i18n="@@cartDeliveryOptionBringDescription">Get the items sent to you with Bring from one of our storage facilities</p>
                    </div>
                </div>
				<div class="row mt-2" *ngIf="bringInputWarning">
					<div class="col-12">
						<div class="alert alert-warning">
							<fa-icon [icon]="'exclamation-triangle'" class="mr-2"></fa-icon>
							<span *ngIf="bringInputWarning === 'invalid-name'" i18n="@@cartDeliveryOptionBranchInvalidName">please provide a valid name</span>
							<span *ngIf="bringInputWarning === 'invalid-address'" i18n="@@cartDeliveryOptionBranchInvalidAddress">please provide a valid address</span>
							<span *ngIf="bringInputWarning === 'invalid-postal-code'" i18n="@@cartDeliveryOptionBranchInvalidPostalCode">please provide a valid postal code</span>
							<span *ngIf="bringInputWarning === 'invalid-postal-city'" i18n="@@cartDeliveryOptionBranchInvalidPostalCity">please provide a valid postal city</span>
						</div>
					</div>
				</div>
				<div class="row mt-5" *ngIf="deliveryMethod === 'bring'">
                    <div class="col-12">
                        <h5 i18n="@@cartDeliveryShipmentAddressTitle">Shipment address</h5>
                    </div>
                    <div class="col-12">
                        <div class="input-group mb-3 input-group-lg">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <fa-icon [icon]="'user'"></fa-icon>
                                </span>
                            </div>

                            <input
                                type="text"
                                class="form-control"
								i18n-placeholder="@@cartDeliveryShipmentNamePlaceholder"
                                placeholder="Full Name"
								(change)="validateDeliveryMethodBring()"
								(keydown.enter)="onSetDelivery('bring')"
                                [(ngModel)]="toName">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="input-group mb-3 input-group-lg">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
									<fa-icon [icon]="'address-card'"></fa-icon>
                                </span>
                            </div>

                            <input
                                type="text"
                                class="form-control"
								i18n-placeholder="@@cartDeliveryShipmentAddressPlaceholder"
                                placeholder="Address"
								(change)="validateDeliveryMethodBring()"
								(keydown.enter)="onSetDelivery('bring')"
                                [(ngModel)]="toAddress">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="input-group mb-3 input-group-lg">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <fa-icon [icon]="'address-card'"></fa-icon>
                                </span>
                            </div>

                            <input
                                type="text"
                                maxlength="4"
                                class="form-control"
								(change)="onPostalCodeChange()"
								(keydown.enter)="onSetDelivery('bring')"
								i18n-placeholder="@@cartDeliveryShipmentPostalCodePlaceholder"
                                placeholder="Postal code"
                                [(ngModel)]="toPostalCode">

                            <input
                                type="text"
                                class="form-control"
								i18n-placeholder="@@cartDeliveryShipmentPostalCityPlaceholder"
                                placeholder="city"
								(keydown.enter)="onSetDelivery('bring')"
								[(ngModel)]="toPostalCity">
                        </div>
                    </div>
					<div class="col-12 mt-2">
						<button class="btn btn-outline-success btn-block" (click)="onSetDelivery('bring')">
							<span i18n="@@cartDeliveryConfirmShippingAddressButton">Confirm shipping address</span>
						</button>
					</div>
                </div>
			</div>
            <div class="card-footer" *ngIf="deliveryMethod === 'bring' && currentDelivery && currentDelivery.amount !== 0 && !failureText">
				<div class="row justify-content-between">
					<div class="col-auto text-secondary">
						<span i18n="@@cartDeliveryEstimatedDeliveryDate">Estimated delivery date</span>
					</div>
					<div class="col-auto">
						<div class="row justify-content-end">
							<div class="col-auto">
								{{currentDelivery.info['estimatedDelivery'] | blcDate:'until'}}
							</div>
						</div>
						<div class="row justify-content-end">
							<div class="col-auto text-secondary">
								<small>{{currentDelivery.info['estimatedDelivery'] | blcDate}}</small>
							</div>
						</div>
					</div>
				</div>
                <div class="row justify-content-between mt-2">
					<div class="col-auto text-secondary">
						<span i18n="@@cardDeliveryInfoDeliveryCost">Delivery cost</span>
					</div>
					<div class="col-auto font-weight-bold">
						{{currentDelivery.amount | blcPrice}}
					</div>
				</div>
            </div>
		</div>
	</div>
</div>
